"use strict";(()=>{var e={};e.id=1567,e.ids=[1567],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},67816:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>v,requestAsyncStorage:()=>h,routeModule:()=>x,serverHooks:()=>y,staticGenerationAsyncStorage:()=>w});var a={};r.r(a),r.d(a,{GET:()=>z,POST:()=>g,runtime:()=>m});var n=r(49303),i=r(88716),s=r(60670),o=r(87070),l=r(45609),c=r(95456),u=r(75748),d=r(40791),p=r(47833);let m="nodejs";async function g(e){try{let t;let r=await e.json(),a=(0,d.PR)(d.j8,r),n=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"unknown",i=e.headers.get("user-agent")||"unknown",s=e.headers.get("referer");if("false"!==process.env.REQUIRE_AUTH){let e=await (0,l.getServerSession)(c.Lz);t=e?.user?.id}let p=a.properties?.projectId||"default-project",m=await u.db.analytics.create({data:{event:a.event,page:a.page,referrer:s||a.referrer,userAgent:i,ip:n,properties:a.properties,projectId:p,userId:t}});return o.NextResponse.json({success:!0,data:{id:m.id},message:"Analytics event recorded"})}catch(r){let{message:e,statusCode:t}=(0,p.zG)(r);return o.NextResponse.json({success:!1,error:e},{status:t})}}async function z(e){try{let{searchParams:t}=new URL(e.url),r=t.get("projectId"),a=t.get("event"),n=t.get("startDate"),i=t.get("endDate");if("false"!==process.env.REQUIRE_AUTH){let e=await (0,l.getServerSession)(c.Lz);if(!e?.user)throw new p._7}let s={};r&&(s.projectId=r),a&&(s.event=a),n&&i&&(s.timestamp={gte:new Date(n),lte:new Date(i)});let[d,m,g]=await Promise.all([u.db.analytics.findMany({where:s,orderBy:{timestamp:"desc"},take:100}),u.db.analytics.count({where:s}),u.db.analytics.groupBy({by:["ip"],where:s,_count:{ip:!0}})]),z=d.filter(e=>"page_view"===e.event).length,x=g.length;return o.NextResponse.json({success:!0,data:{events:d,metrics:{totalEvents:m,pageViews:z,uniqueVisitors:x}}})}catch(r){let{message:e,statusCode:t}=(0,p.zG)(r);return o.NextResponse.json({success:!1,error:e},{status:t})}}let x=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/analytics/route",pathname:"/api/analytics",filename:"route",bundlePath:"app/api/analytics/route"},resolvedPagePath:"/root/Zenith-Fresh/src/app/api/analytics/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:w,serverHooks:y}=x,b="/api/analytics/route";function v(){return(0,s.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:w})}},95456:(e,t,r)=>{r.d(t,{Lz:()=>d,r4:()=>m});var a=r(13539),n=r(53797),i=r(77234),s=r(77210),o=r(42023),l=r.n(o),c=r(75748),u=r(47833);let d={adapter:(0,a.N)(c.db),providers:[(0,n.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)throw new u._7("Missing credentials");let t=await c.db.user.findUnique({where:{email:e.email},include:{organizations:{include:{organization:!0}}}});if(!t||!t.password||!await l().compare(e.password,t.password))throw new u._7("Invalid credentials");return{id:t.id,email:t.email,name:t.name,avatar:t.avatar,organizations:t.organizations.map(e=>({id:e.organization.id,name:e.organization.name,role:e.role}))}}}),...process.env.GOOGLE_CLIENT_ID&&process.env.GOOGLE_CLIENT_SECRET?[(0,i.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET})]:[],...process.env.GITHUB_CLIENT_ID&&process.env.GITHUB_CLIENT_SECRET?[(0,s.Z)({clientId:process.env.GITHUB_CLIENT_ID,clientSecret:process.env.GITHUB_CLIENT_SECRET})]:[]],session:{strategy:"jwt",maxAge:2592e3},pages:{signIn:"/auth/signin",signUp:"/auth/signup",error:"/auth/error"},callbacks:{async jwt({token:e,user:t,account:r}){if(t&&(e.id=t.id,e.organizations=t.organizations||[]),r?.provider&&"credentials"!==r.provider){let t=await c.db.user.findUnique({where:{email:e.email},include:{organizations:{include:{organization:!0}}}});t&&(e.id=t.id,e.organizations=t.organizations.map(e=>({id:e.organization.id,name:e.organization.name,role:e.role})))}return e},session:async({session:e,token:t})=>(t&&e.user&&(e.user.id=t.id,e.user.organizations=t.organizations||[]),e),signIn:async({user:e,account:t,profile:r})=>(t?.provider,!0)},events:{async signIn({user:e,account:t,profile:r,isNewUser:a}){console.log(`User signed in: ${e.email} via ${t?.provider}`)},async signOut({session:e,token:t}){console.log(`User signed out: ${e?.user?.email}`)}},debug:!1};async function p(e){return l().hash(e,12)}async function m(e){let t=await c.db.user.findFirst({where:{OR:[{email:e.email},...e.username?[{username:e.username}]:[]]}});if(t){if(t.email===e.email)throw new u._7("Email already exists");if(t.username===e.username)throw new u._7("Username already exists")}let r=await p(e.password);return c.db.user.create({data:{email:e.email,password:r,name:e.name,username:e.username},select:{id:!0,email:!0,name:!0,username:!0,createdAt:!0}})}},75748:(e,t,r)=>{r.d(t,{db:()=>n});var a=r(53524);let n=globalThis.prisma??new a.PrismaClient({log:["error"]})},47833:(e,t,r)=>{r.d(t,{_7:()=>n,dR:()=>i,zG:()=>s});class a extends Error{constructor(e,t=500,r="INTERNAL_ERROR"){super(e),this.message=e,this.statusCode=t,this.code=r,this.name="AppError"}}class n extends a{constructor(e="Authentication required"){super(e,401,"AUTHENTICATION_ERROR"),this.name="AuthenticationError"}}class i extends a{constructor(e="Resource"){super(`${e} not found`,404,"NOT_FOUND"),this.name="NotFoundError"}}function s(e){return(console.error("API Error:",e),e instanceof a)?{message:e.message,statusCode:e.statusCode,code:e.code}:e instanceof Error?{message:e.message,statusCode:500,code:"INTERNAL_ERROR"}:{message:"An unexpected error occurred",statusCode:500,code:"UNKNOWN_ERROR"}}},40791:(e,t,r)=>{r.d(t,{HF:()=>n,PR:()=>c,Uo:()=>i,dC:()=>l,j8:()=>o,x3:()=>s});var a=r(9133);a.z.object({email:a.z.string().email("Invalid email address"),password:a.z.string().min(8,"Password must be at least 8 characters"),name:a.z.string().min(1,"Name is required").optional(),username:a.z.string().min(3,"Username must be at least 3 characters").optional()}),a.z.object({name:a.z.string().min(1,"Name is required").optional(),username:a.z.string().min(3,"Username must be at least 3 characters").optional(),bio:a.z.string().max(500,"Bio must be less than 500 characters").optional(),website:a.z.string().url("Invalid website URL").optional(),location:a.z.string().max(100,"Location must be less than 100 characters").optional()}),a.z.object({name:a.z.string().min(1,"Project name is required").max(100,"Project name too long"),slug:a.z.string().min(1,"Slug is required").regex(/^[a-z0-9-]+$/,"Slug can only contain lowercase letters, numbers, and hyphens"),description:a.z.string().max(500,"Description too long").optional(),organizationId:a.z.string().cuid("Invalid organization ID").optional()});let n=a.z.object({name:a.z.string().min(1,"Project name is required").max(100,"Project name too long").optional(),slug:a.z.string().min(1,"Slug is required").regex(/^[a-z0-9-]+$/,"Slug can only contain lowercase letters, numbers, and hyphens").optional(),description:a.z.string().max(500,"Description too long").optional(),status:a.z.enum(["ACTIVE","ARCHIVED","DRAFT"]).optional(),visibility:a.z.enum(["PUBLIC","PRIVATE","UNLISTED"]).optional(),domain:a.z.string().regex(/^[a-z0-9.-]+\.[a-z]{2,}$/,"Invalid domain format").optional(),customDomain:a.z.string().regex(/^[a-z0-9.-]+\.[a-z]{2,}$/,"Invalid domain format").optional(),seoTitle:a.z.string().max(60,"SEO title too long").optional(),seoDescription:a.z.string().max(160,"SEO description too long").optional()}),i=a.z.object({title:a.z.string().min(1,"Page title is required").max(200,"Title too long"),slug:a.z.string().min(1,"Slug is required").regex(/^[a-z0-9-\/]+$/,"Slug can only contain lowercase letters, numbers, hyphens, and slashes"),content:a.z.any().optional(),metaTitle:a.z.string().max(60,"Meta title too long").optional(),metaDescription:a.z.string().max(160,"Meta description too long").optional(),keywords:a.z.array(a.z.string()).max(10,"Too many keywords").optional(),published:a.z.boolean().optional()}),s=i.partial();a.z.object({name:a.z.string().min(1,"Organization name is required").max(100,"Name too long"),slug:a.z.string().min(1,"Slug is required").regex(/^[a-z0-9-]+$/,"Slug can only contain lowercase letters, numbers, and hyphens"),description:a.z.string().max(500,"Description too long").optional(),website:a.z.string().url("Invalid website URL").optional()}).partial();let o=a.z.object({event:a.z.string().min(1,"Event name is required"),page:a.z.string().optional(),referrer:a.z.string().optional(),properties:a.z.record(a.z.any()).optional()});a.z.object({name:a.z.string().min(1,"API key name is required").max(100,"Name too long"),expiresAt:a.z.date().optional()});let l=a.z.object({page:a.z.coerce.number().min(1,"Page must be at least 1").default(1),limit:a.z.coerce.number().min(1,"Limit must be at least 1").max(100,"Limit cannot exceed 100").default(10)});function c(e,t){let r=e.safeParse(t);if(!r.success){let e=r.error.errors.map(e=>`${e.path.join(".")}: ${e.message}`);throw Error(`Validation failed: ${e.join(", ")}`)}return r.data}a.z.object({q:a.z.string().min(1,"Search query is required").max(100,"Search query too long"),type:a.z.enum(["projects","pages","users"]).optional()}),a.z.object({file:a.z.instanceof(File,{message:"Invalid file"}),maxSize:a.z.number().default(5242880),allowedTypes:a.z.array(a.z.string()).default(["image/jpeg","image/png","image/webp"])})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[9276,9848,7070,5609,9133],()=>r(67816));module.exports=a})();