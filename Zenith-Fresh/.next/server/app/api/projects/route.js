"use strict";(()=>{var e={};e.id=4871,e.ids=[4871],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},38917:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>q,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>b,staticGenerationAsyncStorage:()=>w});var s={};r.r(s),r.d(s,{GET:()=>z,POST:()=>x,PUT:()=>j,runtime:()=>g});var a=r(49303),n=r(88716),i=r(60670),o=r(87070),l=r(45609),u=r(95456),c=r(75748),p=r(40791),m=r(18603),d=r(47833);let g="nodejs";async function z(e){try{let{searchParams:t}=new URL(e.url),{page:r,limit:s}=(0,p.PR)(p.dC,{page:t.get("page"),limit:t.get("limit")});if("false"!==process.env.REQUIRE_AUTH){let e=await (0,l.getServerSession)(u.Lz);if(!e?.user)throw new d._7}let a=(r-1)*s,[n,i]=await Promise.all([c.db.project.findMany({skip:a,take:s,include:{owner:{select:{id:!0,name:!0,email:!0,avatar:!0}},organization:{select:{id:!0,name:!0,slug:!0}},pages:{select:{id:!0,title:!0,published:!0}},_count:{select:{pages:!0,analytics:!0}}},orderBy:{updatedAt:"desc"}}),c.db.project.count()]);return o.NextResponse.json({success:!0,data:{items:n,pagination:{page:r,limit:s,total:i,totalPages:Math.ceil(i/s)}}})}catch(r){let{message:e,statusCode:t}=(0,d.zG)(r);return o.NextResponse.json({success:!1,error:e},{status:t})}}async function x(e){try{let t="test-user";if("false"!==process.env.REQUIRE_AUTH){let e=await (0,l.getServerSession)(u.Lz);if(!e?.user)throw new d._7;t=e.user.id}else t=(await c.db.user.upsert({where:{email:"test@zenith.com"},update:{},create:{email:"test@zenith.com",name:"Test User",username:"testuser"}})).id;let r=await e.json(),s=m.L.safeParse(r);if(!s.success)return o.NextResponse.json({error:"Invalid request data",details:s.error.errors.map(e=>({field:e.path.join("."),message:e.message}))},{status:400});let a=s.data,n=(r.slug||a.name).toLowerCase().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),i=n,p=1;for(;await c.db.project.findUnique({where:{slug:i}});)i=`${n}-${p}`,p++;let g=await c.db.project.create({data:{name:a.name,slug:i,description:a.description,ownerId:t,organizationId:r.organizationId,status:a.status||"DRAFT",type:a.type||"website"},include:{owner:{select:{id:!0,name:!0,email:!0,avatar:!0}},organization:{select:{id:!0,name:!0,slug:!0}}}});return o.NextResponse.json({success:!0,data:g,message:"Project created successfully"},{status:201})}catch(r){let{message:e,statusCode:t}=(0,d.zG)(r);return o.NextResponse.json({success:!1,error:e},{status:t})}}async function j(e){try{let t="test-user";if("false"!==process.env.REQUIRE_AUTH){let e=await (0,l.getServerSession)(u.Lz);if(!e?.user)throw new d._7;t=e.user.id}let{id:r,...s}=await e.json();if(!r)return o.NextResponse.json({error:"Project ID is required"},{status:400});let a=m.yj.safeParse(s);if(!a.success)return o.NextResponse.json({error:"Invalid request data",details:a.error.errors.map(e=>({field:e.path.join("."),message:e.message}))},{status:400});let n=a.data,i=await c.db.project.findUnique({where:{id:r}});if(!i)throw new d.dR("Project not found");if("false"!==process.env.REQUIRE_AUTH&&i.ownerId!==t)return o.NextResponse.json({error:"Access denied"},{status:403});let p=await c.db.project.update({where:{id:r},data:{...n.name&&{name:n.name},...n.description&&{description:n.description},...n.status&&{status:n.status},...n.type&&{type:n.type},updatedAt:new Date},include:{owner:{select:{id:!0,name:!0,email:!0,avatar:!0}},organization:{select:{id:!0,name:!0,slug:!0}}}});return o.NextResponse.json({success:!0,data:p,message:"Project updated successfully"})}catch(r){let{message:e,statusCode:t}=(0,d.zG)(r);return o.NextResponse.json({success:!1,error:e},{status:t})}}let h=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/projects/route",pathname:"/api/projects",filename:"route",bundlePath:"app/api/projects/route"},resolvedPagePath:"/root/Zenith-Fresh/src/app/api/projects/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:w,serverHooks:b}=h,y="/api/projects/route";function q(){return(0,i.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:w})}},40791:(e,t,r)=>{r.d(t,{HF:()=>a,PR:()=>u,Uo:()=>n,dC:()=>l,j8:()=>o,x3:()=>i});var s=r(9133);s.z.object({email:s.z.string().email("Invalid email address"),password:s.z.string().min(8,"Password must be at least 8 characters"),name:s.z.string().min(1,"Name is required").optional(),username:s.z.string().min(3,"Username must be at least 3 characters").optional()}),s.z.object({name:s.z.string().min(1,"Name is required").optional(),username:s.z.string().min(3,"Username must be at least 3 characters").optional(),bio:s.z.string().max(500,"Bio must be less than 500 characters").optional(),website:s.z.string().url("Invalid website URL").optional(),location:s.z.string().max(100,"Location must be less than 100 characters").optional()}),s.z.object({name:s.z.string().min(1,"Project name is required").max(100,"Project name too long"),slug:s.z.string().min(1,"Slug is required").regex(/^[a-z0-9-]+$/,"Slug can only contain lowercase letters, numbers, and hyphens"),description:s.z.string().max(500,"Description too long").optional(),organizationId:s.z.string().cuid("Invalid organization ID").optional()});let a=s.z.object({name:s.z.string().min(1,"Project name is required").max(100,"Project name too long").optional(),slug:s.z.string().min(1,"Slug is required").regex(/^[a-z0-9-]+$/,"Slug can only contain lowercase letters, numbers, and hyphens").optional(),description:s.z.string().max(500,"Description too long").optional(),status:s.z.enum(["ACTIVE","ARCHIVED","DRAFT"]).optional(),visibility:s.z.enum(["PUBLIC","PRIVATE","UNLISTED"]).optional(),domain:s.z.string().regex(/^[a-z0-9.-]+\.[a-z]{2,}$/,"Invalid domain format").optional(),customDomain:s.z.string().regex(/^[a-z0-9.-]+\.[a-z]{2,}$/,"Invalid domain format").optional(),seoTitle:s.z.string().max(60,"SEO title too long").optional(),seoDescription:s.z.string().max(160,"SEO description too long").optional()}),n=s.z.object({title:s.z.string().min(1,"Page title is required").max(200,"Title too long"),slug:s.z.string().min(1,"Slug is required").regex(/^[a-z0-9-\/]+$/,"Slug can only contain lowercase letters, numbers, hyphens, and slashes"),content:s.z.any().optional(),metaTitle:s.z.string().max(60,"Meta title too long").optional(),metaDescription:s.z.string().max(160,"Meta description too long").optional(),keywords:s.z.array(s.z.string()).max(10,"Too many keywords").optional(),published:s.z.boolean().optional()}),i=n.partial();s.z.object({name:s.z.string().min(1,"Organization name is required").max(100,"Name too long"),slug:s.z.string().min(1,"Slug is required").regex(/^[a-z0-9-]+$/,"Slug can only contain lowercase letters, numbers, and hyphens"),description:s.z.string().max(500,"Description too long").optional(),website:s.z.string().url("Invalid website URL").optional()}).partial();let o=s.z.object({event:s.z.string().min(1,"Event name is required"),page:s.z.string().optional(),referrer:s.z.string().optional(),properties:s.z.record(s.z.any()).optional()});s.z.object({name:s.z.string().min(1,"API key name is required").max(100,"Name too long"),expiresAt:s.z.date().optional()});let l=s.z.object({page:s.z.coerce.number().min(1,"Page must be at least 1").default(1),limit:s.z.coerce.number().min(1,"Limit must be at least 1").max(100,"Limit cannot exceed 100").default(10)});function u(e,t){let r=e.safeParse(t);if(!r.success){let e=r.error.errors.map(e=>`${e.path.join(".")}: ${e.message}`);throw Error(`Validation failed: ${e.join(", ")}`)}return r.data}s.z.object({q:s.z.string().min(1,"Search query is required").max(100,"Search query too long"),type:s.z.enum(["projects","pages","users"]).optional()}),s.z.object({file:s.z.instanceof(File,{message:"Invalid file"}),maxSize:s.z.number().default(5242880),allowedTypes:s.z.array(s.z.string()).default(["image/jpeg","image/png","image/webp"])})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,9848,7070,5609,9133,4991,5385],()=>r(38917));module.exports=s})();